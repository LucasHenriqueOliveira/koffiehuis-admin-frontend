<form [formGroup]="manualForm" (ngSubmit)="onSubmit()">
	<fieldset class="fieldset">
		<legend>Veículo</legend>
		<p>
			Selecione a marca, modelo, ano e versão
		</p>
		<div class="form-row">
			<div class="form-group col-md-4">
				<select id="inputMarcas" class="form-control" formControlName="selectedMarca" (change)="onChangeMarca($event)">
					<option selected value="0">Selecione a marca</option>
					<option *ngFor="let marca of arrMarcas" [value]="marca.id">{{marca.marca}}</option>
				</select>
			</div>
			<div class="form-group col-md-8">
				<select id="inputModelos" class="form-control" formControlName="selectedModelo" (change)="onChangeModelo($event)">
					<option selected value="0">Selecione o modelo</option>
					<option *ngFor="let modelo of arrModelos" [value]="modelo.id">{{modelo.modelo}}</option>
				</select>
			</div>
			<div class="form-group col-md-2">
				<select id="inputAno" class="form-control" formControlName="selectedAno" (change)="onChangeAno($event)">
					<option selected value="0">Selecione o ano</option>
					<option *ngFor="let ano of arrAnos" [value]="ano.id">{{ano.ano}}</option>
				</select>
			</div>
			<div class="form-group col-md-10">
				<select id="inputVersao" class="form-control" formControlName="selectedVersao" (change)="onChangeVersao($event)">
					<option selected value="0">Selecione a versão</option>
					<option *ngFor="let versao of arrVersoes" [value]="versao.id_versao">{{versao.versao}}</option>
				</select>
			</div>
		</div>
	</fieldset>
	<fieldset class="fieldset">
		<legend>Rodas e Pneus</legend>
		<p>Acrescente as informações do veículo</p>
		<div class="form-row">
			<div class="form-group col-md-4">
				<select id="inputCabine" class="form-control" formControlName="selectedCabine">
					<option selected value="0">Selecione a cabine</option>
					<option value="Sedan">Sedan</option>
					<option value="Hatch/Compacto">Hatch/Compacto</option>
					<option value="SUV/Crossover">SUV/Crossover</option>
					<option value="Pickup">Pickup</option>
					<option value="Perua(Station Wagon)">Perua(Station Wagon)</option>
					<option value="Cupê/Conversível">Cupê/Conversível</option>
					<option value="Van/Furgão">Van/Furgão</option>
					<option value="Minivan">Minivan</option>
					<option value="Buggy/Jipe">Buggy/Jipe</option>
					<option value="Outros">Outros</option>
				</select>
			</div>
			<div class="form-group col-md-4">
				<input type="text" class="form-control" id="inputRodaRaio" placeholder="Raio Roda" formControlName="inputRodaRaio">
			</div>
			<div class="form-group col-md-4">
				<input type="text" class="form-control" id="inputPneuMedida" placeholder="Medida Pneu" formControlName="inputPneuMedida">
			</div>
			<div class="form-group col-md-6">
				
				<table class="table">
					<thead>
						<tr>
							<th scope="col" class="text-center no-border">Carga</th>
							<th scope="col" class="text-center no-border">Local</th>
							<th scope="col" class="no-border"></th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td scope="row" class="text-center">Normal</td>
							<td scope="row" class="text-center">Traseira</td>
							<td scope="row">
								<input type="text" class="form-control" placeholder="Calibragem psi" formControlName="inputNormalTraseiraCalibragemPsi">
							</td>
						</tr>
						<tr>
							<td scope="row" class="text-center">Normal</td>
							<td scope="row" class="text-center">Dianteira</td>
							<td scope="row">
								<input type="text" class="form-control" placeholder="Calibragem psi" formControlName="inputNormalDianteiraCalibragemPsi">
							</td>
						</tr>
						<tr>
							<td scope="row" class="text-center">Completa</td>
							<td scope="row" class="text-center">Traseira</td>
							<td scope="row">
								<input type="text" class="form-control" placeholder="Calibragem psi" formControlName="inputCompletaTraseiraCalibragemPsi">
							</td>
						</tr>
						<tr>
							<td scope="row" class="text-center">Completa</td>
							<td scope="row" class="text-center">Dianteira</td>
							<td scope="row">
								<input type="text" class="form-control" placeholder="Calibragem psi" formControlName="inputCompletaDianteiraCalibragemPsi">
							</td>
						</tr>
						<tr>
							<td scope="row" class="text-center"></td>
							<td scope="row" class="text-center">Estepe</td>
							<td scope="row">
								<input type="text" class="form-control" placeholder="Calibragem psi" formControlName="inputEstepeCalibragemPsi">
							</td>
						</tr>
					</tbody>
				</table>
			</div>
			<div class="form-group col-md-12">
				<textarea class="form-control" rows="3" id="observacaoInfo" placeholder="Observação" formControlName="observacaoInfo"></textarea>
			</div>
		</div>
	</fieldset>
	<fieldset class="fieldset">
		<legend>Fluidos</legend>
		<p>Adicione os fluidos</p>
		<a class="btn btn-sm btn-primary btn-add" (click)="openFluido(contentFluido)">Adicionar</a>
		<br /><br />
		<table class="table table-bordered" *ngIf="arrFluidosAdd.length">
			<thead>
				<tr>
					<th scope="col">Fluido</th>
					<th scope="col">Descrição</th>
					<th scope="col" class="text-center">Litros</th>
					<th scope="col" class="text-center">Obs</th>
					<th scope="col" class="text-center">Ação</th>
				</tr>
			</thead>
			<tbody>
				<tr *ngFor="let fluido of arrFluidosAdd; let i = index">
					<td scope="row">{{fluido.nome}}</td>
					<td scope="row">
						{{fluido.descricao1}}<br />
						{{fluido.descricao2}}<br />
						{{fluido.descricao3}}
					</td>
					<td scope="row" class="text-center">{{fluido.litros}}</td>
					<td scope="row" class="text-center">
						<ng-template #popObservacaoFluido>{{fluido.observacao}}</ng-template>
						<i class="fa fa-commenting-o" *ngIf="fluido.observacao" aria-hidden="true" [ngbPopover]="popObservacaoFluido"
						triggers="mouseenter:mouseleave" popoverTitle="Observação"></i>
					</td>
					<td scope="row" class="text-center">
						<a (click)="editarFluido(fluido, i)">
							<i class="fa fa-pencil" aria-hidden="true"></i>
						</a> &nbsp;
						<a (click)="removeFluido(fluido)">
							<i class="fa fa-trash" aria-hidden="true"></i>
						</a>
					</td>
				</tr>
			</tbody>
		</table>
		<textarea class="form-control" rows="3" id="observacaoGeralFluido" placeholder="Observação" formControlName="observacaoGeralFluido"></textarea>
	</fieldset>
	<fieldset class="fieldset">
		<legend>Itens do Manual</legend>
		<p>
			Selecione o título, marque os itens do manual relacionados e clique em adicionar
		</p>
		<div class="form-row">
			<div class="form-group col-md-2">
				<select id="inputTitulo" class="form-control" formControlName="selectedTitulo" (change)="onChangeTitulo($event)">
					<option selected value="0">Selecione o título</option>
					<option *ngFor="let titulo of arrTitulos" [value]="titulo.id">{{titulo.titulo}}</option>
				</select>
			</div>
			<div class="form-group col-md-12" *ngFor="let item of options">
				<div class="form-check inline-block">
					<input type="checkbox" class="form-check-input" name="itens[{{item.id}}]" id="check_{{item.id}}" [value]="item.id"
					(change)="setItens($event.target.getAttribute('value'), $event.target.checked, item.item, contentItem, contentDelete)">
					<label class="form-check-label" for="check_{{item.id}}">{{ item.item }}</label>
					&nbsp;<i class="fa fa-exclamation-triangle" *ngIf="item.altera_uso" aria-hidden="true"></i>
				</div>
			</div>
		</div>
	</fieldset>
	<div>
		<ul class="list-group list-group-flush">
			<li *ngIf="txtMarca" class="list-group-item"><b>Marca:</b> {{txtMarca}}</li>
			<li *ngIf="txtModelo" class="list-group-item"><b>Modelo:</b> {{txtModelo}}</li>
			<li *ngIf="txtAno" class="list-group-item"><b>Ano:</b> {{txtAno}}</li>
			<li *ngIf="txtVersao" class="list-group-item"><b>Versão:</b> {{txtVersao}}</li>
		</ul>
		<br /><br />
		<table class="table table-bordered no-border" *ngIf="arrSelectedItems.length">
			<thead>
				<tr>
					<th scope="col" class="no-border"></th>
					<th scope="col" colspan="3" class="text-center">Ideal</th>
					<th scope="col" colspan="3" class="text-center">Severo</th>
				</tr>
				<tr>
					<td scope="col" class="no-border"></td>
					<th scope="col" class="text-center">Km</th>
					<th scope="col" class="text-center">Meses</th>
					<th scope="col" class="text-center">Obs</th>
					<th scope="col" class="text-center">Km</th>
					<th scope="col" class="text-center">Meses</th>
					<th scope="col" class="text-center">Obs</th>
				</tr>
			</thead>
			<tbody *ngFor="let options of arrSelectedItems">
				<tr>
					<td scope="row" colspan="7" class="titulo" *ngIf="options.items.length">{{options.txtTitulo}}</td>
				</tr>
				<tr *ngFor="let item of options.items">
					<td scope="row">{{item.txtItem}}</td>
					<td scope="row" class="text-center">{{item.km_ideal}}</td>
					<td scope="row" class="text-center">{{item.meses_ideal}}</td>
					<td scope="row" class="text-center">
						<ng-template #popObservacaoIdeal>{{item.observacao_ideal}}</ng-template>
						<i class="fa fa-commenting-o" *ngIf="item.observacao_ideal" aria-hidden="true" [ngbPopover]="popObservacaoIdeal"
						triggers="mouseenter:mouseleave" popoverTitle="Observação"></i>
					</td>
					<td scope="row" class="text-center">{{item.km_severo}}</td>
					<td scope="row" class="text-center">{{item.meses_severo}}</td>
					<td scope="row" class="text-center">
						<ng-template #popObservacaoSevero>{{item.observacao_severo}}</ng-template>
						<i class="fa fa-commenting-o" *ngIf="item.observacao_severo" aria-hidden="true" [ngbPopover]="popObservacaoSevero"
						triggers="mouseenter:mouseleave" popoverTitle="Observação"></i>
					</td>
				</tr>
			</tbody>
			<tbody *ngFor="let options of arrItemsFixo">
				<tr>
					<td scope="row" colspan="7" class="titulo" *ngIf="options.items.length">{{options.txtTitulo}}</td>
				</tr>
				<tr *ngFor="let item of options.items">
					<td scope="row">{{item.item}}</td>
					<td scope="row" class="text-center">{{item.km_ideal}}</td>
					<td scope="row" class="text-center">{{item.tempo_ideal}}</td>
					<td scope="row" class="text-center">
						<ng-template #popObservacaoIdeal>{{item.observacao_ideal}}</ng-template>
						<i class="fa fa-commenting-o" *ngIf="item.observacao_ideal" aria-hidden="true" [ngbPopover]="popObservacaoIdeal"
						triggers="mouseenter:mouseleave" popoverTitle="Observação"></i>
					</td>
					<td scope="row" class="text-center">{{item.km_severo}}</td>
					<td scope="row" class="text-center">{{item.tempo_severo}}</td>
					<td scope="row" class="text-center">
						<ng-template #popObservacaoSevero>{{item.observacao_severo}}</ng-template>
						<i class="fa fa-commenting-o" *ngIf="item.observacao_severo" aria-hidden="true" [ngbPopover]="popObservacaoSevero"
						triggers="mouseenter:mouseleave" popoverTitle="Observação"></i>
					</td>
				</tr>
			</tbody>
		</table>
		<div class="form-group" *ngIf="arrSelectedItems.length">
			<label for="observacao">Observação:</label>
			<textarea class="form-control" rows="5" id="observacao" formControlName="observacao"></textarea>
		</div>
	</div>
	<div class="form-row">
		<div class="form-group col-md-12 text-center">
			<button class="btn btn-primary btn-lg" [disabled]="!checkButton()">Salvar</button>
		</div>
	</div>
</form>

<div [ngClass]="{'loading': loading}"></div>

<ng-template #contentItem let-modal>
	<div class="modal-header">
		<h4 class="modal-title">{{textItem}}</h4>
		<button type="button" class="close" aria-label="Close" (click)="closeItem()">
		<span aria-hidden="true">&times;</span>
		</button>
	</div>
	<div class="modal-body">
		<p>Ideal <br /></p>
		<div class="form-row">
			<div class="form-group col-sm-6">
				<input type="number" class="form-control" ngbAutofocus [(ngModel)]="km_ideal" [ngModelOptions]="{standalone: true}" name="km_ideal" value="" placeholder="Km">
			</div>
			<div class="form-group col-sm-6">
				<input type="number" class="form-control" [(ngModel)]="meses_ideal" [ngModelOptions]="{standalone: true}" name="meses_ideal" value="" placeholder="Meses">
			</div>
			<div class="form-group col-sm-12">
				<textarea class="form-control" rows="3" [(ngModel)]="observacao_ideal" [ngModelOptions]="{standalone: true}" placeholder="Observação"></textarea>
			</div>
		</div>
		<p>Severo <br /></p>
		<div class="form-row">
			<div class="form-group col-sm-6">
				<input type="number" class="form-control" [(ngModel)]="km_severo" [ngModelOptions]="{standalone: true}" name="km_severo" value="" placeholder="Km">
			</div>
			<div class="form-group col-sm-6">
				<input type="number" class="form-control" [(ngModel)]="meses_severo" [ngModelOptions]="{standalone: true}" name="meses_severo" value="" placeholder="Meses">
			</div>
			<div class="form-group col-sm-12">
				<textarea class="form-control" rows="3" [(ngModel)]="observacao_severo" [ngModelOptions]="{standalone: true}" placeholder="Observação"></textarea>
			</div>
		</div>
	</div>
	<div class="modal-footer">
		<button type="button" class="btn btn-light" (click)="closeItem()">Cancelar</button>
		<button type="button" class="btn btn-danger" (click)="addItem(km_ideal, meses_ideal, observacao_ideal, km_severo, meses_severo, observacao_severo)">Adicionar</button>
	</div>
</ng-template>

<ng-template #contentDelete let-modal>
	<div class="modal-header">
		<h4 class="modal-title">Deletar item do manual</h4>
		<button type="button" class="close" aria-label="Close" (click)="cancelRemoveItem()">
		<span aria-hidden="true">&times;</span>
		</button>
	</div>
	<div class="modal-body">
		<p>Você deseja apagar o item do manual?</p>
	</div>
	<div class="modal-footer">
		<button type="button" class="btn btn-light" (click)="cancelRemoveItem()">Não</button>
		<button type="button" class="btn btn-danger" ngbAutofocus (click)="removeItem()">Sim</button>
	</div>
</ng-template>

<ng-template #contentFluido let-modal>
	<div class="modal-header">
		<h4 class="modal-title">Adicionar o fluido</h4>
		<button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
		<span aria-hidden="true">&times;</span>
		</button>
	</div>
	<div class="modal-body">
		<div class="form-group col-md-12">
			<select id="inputFluido" ngbAutofocus class="form-control" (change)="setFluidoNome($event)" [(ngModel)]="tipo_fluido" [ngModelOptions]="{standalone: true}">
				<option selected value="0">Selecione o fluido</option>
				<option *ngFor="let fluido of arrFluidos" [value]="fluido.id">{{fluido.nome}}</option>
			</select>
		</div>
		<div class="form-group col-sm-12">
			<input type="text" class="form-control" [(ngModel)]="descricao_fluido1" [ngModelOptions]="{standalone: true}" name="descricao_fluido1" value="" placeholder="Descrição 1">
		</div>
		<div class="form-group col-sm-12">
			<input type="text" class="form-control" [(ngModel)]="descricao_fluido2" [ngModelOptions]="{standalone: true}" name="descricao_fluido2" value="" placeholder="Descrição 2">
		</div>
		<div class="form-group col-sm-12">
			<input type="text" class="form-control" [(ngModel)]="descricao_fluido3" [ngModelOptions]="{standalone: true}" name="descricao_fluido3" value="" placeholder="Descrição 3">
		</div>
		<div class="form-group col-sm-12">
			<input type="text" class="form-control" [(ngModel)]="litros_fluido" [ngModelOptions]="{standalone: true}" name="litros_fluido" value="" placeholder="Litros">
		</div>
		<div class="form-group col-sm-12">
			<textarea class="form-control" rows="3" [(ngModel)]="observacao_fluido" [ngModelOptions]="{standalone: true}" placeholder="Observação"></textarea>
		</div>
	</div>
	<div class="modal-footer">
		<button type="button" class="btn btn-light" (click)="modal.dismiss('Cross click')">Cancelar</button>
		<button type="button" class="btn btn-danger" ngbAutofocus (click)="addFluido()">Salvar</button>
	</div>
</ng-template>